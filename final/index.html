<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Финал</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root { --bg:#0b0c0f; --fg:#e6e6e6; --muted:#9aa0a6; --accent:#ff6b91; }
  html,body{height:100%}
  body{
    margin:0; background:radial-gradient(ellipse at 50% 30%, #14161b 0%, var(--bg) 60%);
    color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    display:flex; flex-direction:column; align-items:center; justify-content:center; padding:24px; gap:12px;
  }
  .card{
    width:min(780px, 100%); background:rgba(255,255,255,.03);
    border:1px solid rgba(255,255,255,.07); border-radius:18px; padding:28px 22px;
    box-shadow:0 10px 40px rgba(0,0,0,.35);
  }
  h1{margin:0 0 8px; font-weight:650; letter-spacing:.2px}
  p.lead{margin:.25rem 0 1.1rem; color:var(--muted)}
  .row{display:flex; gap:10px; margin-top:10px}
  input[type="text"]{
    flex:1; padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.03); color:var(--fg); font-size:16px; outline:none;
  }
  button{
    padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.08); color:var(--fg); font-weight:700; cursor:pointer; min-width:120px;
  }
  button:hover{background:rgba(255,255,255,.12)}
  button:disabled{opacity:.5; cursor:not-allowed}
  .msg{margin-top:10px; font-size:14px}
  .msg.ok{color:#8be78b}
  .msg.err{color:#ff9aa2}

  .final{
    width:min(780px, 100%); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.09); border-radius:18px; padding:26px 22px; margin-top:10px;
    box-shadow:0 10px 40px rgba(0,0,0,.35); position:relative; overflow:hidden;
    display:none; /* появится после верного ввода */
  }
  .final.show{ display:block; animation:rise .9s ease both; }
  @keyframes rise{ from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }

  .heart {
    position:absolute; width:10px; height:10px; left:50%; top:100%;
    background:var(--accent); transform:translateX(-50%) rotate(45deg);
    animation: floatUp 4s ease-in infinite;
    box-shadow:0 0 20px rgba(255,107,145,.45);
  }
  .heart::before, .heart::after{
    content:""; position:absolute; width:10px; height:10px; background:var(--accent); border-radius:50%;
  }
  .heart::before{ left:-50%; top:0 }
  .heart::after{ top:-50%; left:0 }
  @keyframes floatUp {
    0% { opacity:.0; transform:translate(-50%, 0) scale(.8) rotate(45deg) }
    15%{ opacity:.9 }
    100%{ opacity:0; transform:translate(-50%, -220px) scale(1.2) rotate(45deg) }
  }

  .final h2{ margin:0 0 6px; font-weight:700 }
  .final p{ margin:.35rem 0; line-height:1.6 }
  .final .big{ font-size:22px; font-weight:750; letter-spacing:.2px }
  .final .accent{ color:#ffd2de }

  .footnote{width:min(780px,100%); text-align:center; color:var(--muted); font-size:12.5px; opacity:.85; user-select:none;}
</style>
</head>
<body>

  <!-- Карточка ввода собранной фразы -->
  <main class="card" role="main" aria-labelledby="finalTitle">
    <h1 id="finalTitle">Финальный шаг</h1>
    <p class="lead">
      Собери <strong>все ключевые слова</strong> прошлых шагов в одну фразу и введи её здесь.<br>
      Подсказка: это то, что уже звучало между строками.
    </p>

    <div class="row">
      <input id="answer" type="text" inputmode="text" autocomplete="off"
             placeholder="введи фразу полностью…" aria-label="Финальная фраза" />
      <button id="check" disabled>Открыть</button>
    </div>
    <div id="msg" class="msg" aria-live="polite"></div>
  </main>

  <!-- Блок признания (появится после верного ответа) -->
  <section id="finalBlock" class="final" aria-live="polite">
    <!-- парящие сердечки -->
    <div class="heart" style="left:20%; animation-delay:.1s"></div>
    <div class="heart" style="left:40%; animation-delay:.6s"></div>
    <div class="heart" style="left:60%; animation-delay:.3s"></div>
    <div class="heart" style="left:80%; animation-delay:.9s"></div>

    <h2>Это всё — для тебя.</h2>
    <p>Спасибо, что прошла со мной весь путь, шаг за шагом, слово за словом.</p>
    <p>Иногда трудные загадки нужны только для того, чтобы сказать простое и главное.</p>
    <p class="big accent">Я хотел бы быть твоим парнем ❤️</p>
  </section>

  <p class="footnote">Конечно есть код элемента сайта, но интереснее же разгадать самой)</p>

<script>
  // --- Нормализация и проверка ввода ---
  function normalize(s){
    return (s||"")
      .toLowerCase()
      .replaceAll(/[ё]/g, "е")
      .replace(/[^\p{L}\s-]/gu, "") // оставляем буквы/пробел/дефис, убираем прочее
      .replace(/\s+/g, " ")         // схлопываем пробелы
      .trim();
  }

  // Базовая целевая фраза из ключевых слов шагов
  const TARGETS = [
    "я хотел бы стать твоим",       // основная
    "я хотелбы стать твоим",        // без пробела
    "я хотел бы стать  твоим",      // двойные пробелы (на всякий)
  ].map(normalize);

  // Дополнительно: если она введёт уже полную фразу с "парнем" — тоже принимаем
  const ALSO_OK = [
    "я хотел бы стать твоим парнем",
    "я хотелбы стать твоим парнем"
  ].map(normalize);

  function isCorrect(s){
    const n = normalize(s);
    return TARGETS.includes(n) || ALSO_OK.includes(n);
  }

  // --- UI ---
  const input = document.getElementById("answer");
  const btn   = document.getElementById("check");
  const msg   = document.getElementById("msg");
  const finalBlock = document.getElementById("finalBlock");

  // активируем кнопку, когда что-то введено
  input.addEventListener("input", ()=>{
    btn.disabled = input.value.trim().length === 0;
    msg.textContent = "";
    msg.className = "msg";
  });

  function openFinal(){
    const val = input.value;
    if (isCorrect(val)) {
      msg.textContent = "Верно. Отключаю маски…";
      msg.className = "msg ok";
      // показать блок признания
      setTimeout(()=>{
        finalBlock.classList.add("show");
        finalBlock.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 600);
    } else {
      msg.textContent = "Почти. Собери слова в точном порядке и попробуй ещё раз.";
      msg.className = "msg err";
    }
  }

  btn.addEventListener("click", openFinal);
  input.addEventListener("keydown", (e)=>{ if(e.key==="Enter" && !btn.disabled) openFinal(); });
</script>
</body>
</html>
